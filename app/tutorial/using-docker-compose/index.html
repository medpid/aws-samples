<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Getting Started with Docker"><meta name=author content=Docker><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.0, mkdocs-material-4.6.3"><title>Using Docker Compose - Getting Started</title><link rel=stylesheet href=../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#2196f3><script src=../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css><link rel=stylesheet href=../../css/styles.css><link rel=stylesheet href=../../css/dark-mode.css></head> <body dir=ltr data-md-color-primary=blue data-md-color-accent=blue> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#installing-docker-compose tabindex=0 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=../.. title="Getting Started" aria-label="Getting Started" class="md-header-nav__button md-logo"> <img alt=logo src=../../images/docker-labs-logo.svg width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Getting Started </span> <span class=md-header-nav__topic> Using Docker Compose </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/docker/getting-started title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> docker/getting-started </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=../.. title="Getting Started" class="md-nav__button md-logo"> <img alt=logo src=../../images/docker-labs-logo.svg width=48 height=48> </a> Getting Started </label> <div class=md-nav__source> <a href=https://github.com/docker/getting-started title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> docker/getting-started </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ title="Getting Started" class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../our-application/ title="Our Application" class=md-nav__link> Our Application </a> </li> <li class=md-nav__item> <a href=../updating-our-app/ title="Updating our App" class=md-nav__link> Updating our App </a> </li> <li class=md-nav__item> <a href=../sharing-our-app/ title="Sharing our App" class=md-nav__link> Sharing our App </a> </li> <li class=md-nav__item> <a href=../persisting-our-data/ title="Persisting our DB" class=md-nav__link> Persisting our DB </a> </li> <li class=md-nav__item> <a href=../using-bind-mounts/ title="Using Bind Mounts" class=md-nav__link> Using Bind Mounts </a> </li> <li class=md-nav__item> <a href=../multi-container-apps/ title="Multi-Container Apps" class=md-nav__link> Multi-Container Apps </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Using Docker Compose </label> <a href=./ title="Using Docker Compose" class="md-nav__link md-nav__link--active"> Using Docker Compose </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#installing-docker-compose class=md-nav__link> Installing Docker Compose </a> </li> <li class=md-nav__item> <a href=#creating-our-compose-file class=md-nav__link> Creating our Compose File </a> </li> <li class=md-nav__item> <a href=#defining-the-app-service class=md-nav__link> Defining the App Service </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#defining-the-mysql-service class=md-nav__link> Defining the MySQL Service </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#running-our-application-stack class=md-nav__link> Running our Application Stack </a> </li> <li class=md-nav__item> <a href=#seeing-our-app-stack-in-docker-dashboard class=md-nav__link> Seeing our App Stack in Docker Dashboard </a> </li> <li class=md-nav__item> <a href=#tearing-it-all-down class=md-nav__link> Tearing it All Down </a> </li> <li class=md-nav__item> <a href=#recap class=md-nav__link> Recap </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../image-building-best-practices/ title="Image Building Best Practices" class=md-nav__link> Image Building Best Practices </a> </li> <li class=md-nav__item> <a href=../what-next/ title="What Next?" class=md-nav__link> What Next? </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#installing-docker-compose class=md-nav__link> Installing Docker Compose </a> </li> <li class=md-nav__item> <a href=#creating-our-compose-file class=md-nav__link> Creating our Compose File </a> </li> <li class=md-nav__item> <a href=#defining-the-app-service class=md-nav__link> Defining the App Service </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#defining-the-mysql-service class=md-nav__link> Defining the MySQL Service </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#running-our-application-stack class=md-nav__link> Running our Application Stack </a> </li> <li class=md-nav__item> <a href=#seeing-our-app-stack-in-docker-dashboard class=md-nav__link> Seeing our App Stack in Docker Dashboard </a> </li> <li class=md-nav__item> <a href=#tearing-it-all-down class=md-nav__link> Tearing it All Down </a> </li> <li class=md-nav__item> <a href=#recap class=md-nav__link> Recap </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Using Docker Compose</h1> <p><a href=https://docs.docker.com/compose/ >Docker Compose</a> is a tool that was developed to help define and share multi-container applications. With Compose, we can create a YAML file to define the services and with a single command, can spin everything up or tear it all down. </p> <p>The <em>big</em> advantage of using Compose is you can define your application stack in a file, keep it at the root of your project repo (it's now version controlled), and easily enable someone else to contribute to your project. Someone would only need to clone your repo and start the compose app. In fact, you might see quite a few projects on GitHub/GitLab doing exactly this now.</p> <p>So, how do we get started?</p> <h2 id=installing-docker-compose>Installing Docker Compose<a class=headerlink href=#installing-docker-compose title="Permanent link">&para;</a></h2> <p>If you installed Docker Desktop/Toolbox for either Windows or Mac, you already have Docker Compose! Play-with-Docker instances already have Docker Compose installed as well. If you are on a Linux machine, you will need to install Docker Compose using <a href=https://docs.docker.com/compose/install/ >the instructions here</a>. </p> <p>After installation, you should be able to run the following and see version information.</p> <div class=highlight><pre><span></span><code>docker-compose version
</code></pre></div> <h2 id=creating-our-compose-file>Creating our Compose File<a class=headerlink href=#creating-our-compose-file title="Permanent link">&para;</a></h2> <ol> <li> <p>At the root of the app project, create a file named <code>docker-compose.yml</code>.</p> </li> <li> <p>In the compose file, we'll start off by defining the schema version. In most cases, it's best to use the latest supported version. You can look at the <a href=https://docs.docker.com/compose/compose-file/ >Compose file reference</a> for the current schema versions and the compatibility matrix.</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span> <span class=s>&quot;3.8&quot;</span>
</code></pre></div> </li> <li> <p>Next, we'll define the list of services (or containers) we want to run as part of our application.</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span> <span class=s>&quot;3.8&quot;</span>

<span class=hll><span class=nt>services</span><span class=p>:</span>
</span></code></pre></div> </li> </ol> <p>And now, we'll start migrating a service at a time into the compose file.</p> <h2 id=defining-the-app-service>Defining the App Service<a class=headerlink href=#defining-the-app-service title="Permanent link">&para;</a></h2> <p>To remember, this was the command we were using to define our app container.</p> <div class=highlight><pre><span></span><code>docker run -dp <span class=m>3000</span>:3000 <span class=se>\</span>
  -w /app -v <span class=s2>&quot;</span><span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span><span class=s2>:/app&quot;</span> <span class=se>\</span>
  --network todo-app <span class=se>\</span>
  -e <span class=nv>MYSQL_HOST</span><span class=o>=</span>mysql <span class=se>\</span>
  -e <span class=nv>MYSQL_USER</span><span class=o>=</span>root <span class=se>\</span>
  -e <span class=nv>MYSQL_PASSWORD</span><span class=o>=</span>secret <span class=se>\</span>
  -e <span class=nv>MYSQL_DB</span><span class=o>=</span>todos <span class=se>\</span>
  node:12-alpine <span class=se>\</span>
  sh -c <span class=s2>&quot;yarn install &amp;&amp; yarn run dev&quot;</span>
</code></pre></div> <p>If you are using PowerShell then use this command.</p> <div class=highlight><pre><span></span><code><span class=n>docker</span> <span class=n>run</span> <span class=n>-dp</span> <span class=n>3000</span><span class=err>:</span><span class=n>3000</span> <span class=p>`</span>
  <span class=n>-w</span> <span class=p>/</span><span class=n>app</span> <span class=n>-v</span> <span class=s2>&quot;</span><span class=p>$(</span><span class=n>pwd</span><span class=p>)</span><span class=s2>:/app&quot;</span> <span class=p>`</span>
  <span class=p>-</span><span class=n>-network</span> <span class=n>todo-app</span> <span class=p>`</span>
  <span class=n>-e</span> <span class=n>MYSQL_HOST</span><span class=p>=</span><span class=n>mysql</span> <span class=p>`</span>
  <span class=n>-e</span> <span class=n>MYSQL_USER</span><span class=p>=</span><span class=n>root</span> <span class=p>`</span>
  <span class=n>-e</span> <span class=n>MYSQL_PASSWORD</span><span class=p>=</span><span class=n>secret</span> <span class=p>`</span>
  <span class=n>-e</span> <span class=n>MYSQL_DB</span><span class=p>=</span><span class=n>todos</span> <span class=p>`</span>
  <span class=n>node</span><span class=err>:</span><span class=n>12-alpine</span> <span class=p>`</span>
  <span class=n>sh</span> <span class=n>-c</span> <span class=s2>&quot;yarn install &amp;&amp; yarn run dev&quot;</span>
</code></pre></div> <ol> <li> <p>First, let's define the service entry and the image for the container. We can pick any name for the service. The name will automatically become a network alias, which will be useful when defining our MySQL service.</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span> <span class=s>&quot;3.8&quot;</span>

<span class=nt>services</span><span class=p>:</span>
<span class=hll>  <span class=nt>app</span><span class=p>:</span>
</span><span class=hll>    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">node:12-alpine</span>
</span></code></pre></div> </li> <li> <p>Typically, you will see the command close to the <code>image</code> definition, although there is no requirement on ordering. So, let's go ahead and move that into our file.</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span> <span class=s>&quot;3.8&quot;</span>

<span class=nt>services</span><span class=p>:</span>
  <span class=nt>app</span><span class=p>:</span>
    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">node:12-alpine</span>
<span class=hll>    <span class=nt>command</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span>
</span></code></pre></div> </li> <li> <p>Let's migrate the <code>-p 3000:3000</code> part of the command by defining the <code>ports</code> for the service. We will use the <a href=https://docs.docker.com/compose/compose-file/compose-file-v3/#short-syntax-1>short syntax</a> here, but there is also a more verbose <a href=https://docs.docker.com/compose/compose-file/compose-file-v3/#long-syntax-1>long syntax</a> available as well.</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span> <span class=s>&quot;3.8&quot;</span>

<span class=nt>services</span><span class=p>:</span>
  <span class=nt>app</span><span class=p>:</span>
    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">node:12-alpine</span>
    <span class=nt>command</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span>
<span class=hll>    <span class=nt>ports</span><span class=p>:</span>
</span><span class=hll>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3000:3000</span>
</span></code></pre></div> </li> <li> <p>Next, we'll migrate both the working directory (<code>-w /app</code>) and the volume mapping (<code>-v "$(pwd):/app"</code>) by using the <code>working_dir</code> and <code>volumes</code> definitions. Volumes also has a <a href=https://docs.docker.com/compose/compose-file/compose-file-v3/#short-syntax-3>short</a> and <a href=https://docs.docker.com/compose/compose-file/compose-file-v3/#long-syntax-3>long</a> syntax.</p> <p>One advantage of Docker Compose volume definitions is we can use relative paths from the current directory.</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span> <span class=s>&quot;3.8&quot;</span>

<span class=nt>services</span><span class=p>:</span>
  <span class=nt>app</span><span class=p>:</span>
    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">node:12-alpine</span>
    <span class=nt>command</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span>
    <span class=nt>ports</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3000:3000</span>
<span class=hll>    <span class=nt>working_dir</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/app</span>
</span><span class=hll>    <span class=nt>volumes</span><span class=p>:</span>
</span><span class=hll>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./:/app</span>
</span></code></pre></div> </li> <li> <p>Finally, we need to migrate the environment variable definitions using the <code>environment</code> key.</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span> <span class=s>&quot;3.8&quot;</span>

<span class=nt>services</span><span class=p>:</span>
  <span class=nt>app</span><span class=p>:</span>
    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">node:12-alpine</span>
    <span class=nt>command</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span>
    <span class=nt>ports</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3000:3000</span>
    <span class=nt>working_dir</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/app</span>
    <span class=nt>volumes</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./:/app</span>
<span class=hll>    <span class=nt>environment</span><span class=p>:</span>
</span><span class=hll>      <span class=nt>MYSQL_HOST</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
</span><span class=hll>      <span class=nt>MYSQL_USER</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
</span><span class=hll>      <span class=nt>MYSQL_PASSWORD</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">secret</span>
</span><span class=hll>      <span class=nt>MYSQL_DB</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">todos</span>
</span></code></pre></div> </li> </ol> <h3 id=defining-the-mysql-service>Defining the MySQL Service<a class=headerlink href=#defining-the-mysql-service title="Permanent link">&para;</a></h3> <p>Now, it's time to define the MySQL service. The command that we used for that container was the following:</p> <div class=highlight><pre><span></span><code>docker run -d <span class=se>\</span>
  --network todo-app --network-alias mysql <span class=se>\</span>
  -v todo-mysql-data:/var/lib/mysql <span class=se>\</span>
  -e <span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span>secret <span class=se>\</span>
  -e <span class=nv>MYSQL_DATABASE</span><span class=o>=</span>todos <span class=se>\</span>
  mysql:5.7
</code></pre></div> <p>If you are using PowerShell then use this command.</p> <div class=highlight><pre><span></span><code><span class=n>docker</span> <span class=n>run</span> <span class=n>-d</span> <span class=p>`</span>
  <span class=p>-</span><span class=n>-network</span> <span class=n>todo-app</span> <span class=p>-</span><span class=n>-network-alias</span> <span class=n>mysql</span> <span class=p>`</span>
  <span class=n>-v</span> <span class=n>todo-mysql-data</span><span class=err>:</span><span class=p>/</span><span class=n>var</span><span class=p>/</span><span class=n>lib</span><span class=p>/</span><span class=n>mysql</span> <span class=p>`</span>
  <span class=n>-e</span> <span class=n>MYSQL_ROOT_PASSWORD</span><span class=p>=</span><span class=n>secret</span> <span class=p>`</span>
  <span class=n>-e</span> <span class=n>MYSQL_DATABASE</span><span class=p>=</span><span class=n>todos</span> <span class=p>`</span>
  <span class=n>mysql</span><span class=err>:</span><span class=n>5</span><span class=p>.</span><span class=n>7</span>
</code></pre></div> <ol> <li> <p>We will first define the new service and name it <code>mysql</code> so it automatically gets the network alias. We'll go ahead and specify the image to use as well.</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span> <span class=s>&quot;3.8&quot;</span>

<span class=nt>services</span><span class=p>:</span>
  <span class=nt>app</span><span class=p>:</span>
    <span class=c1># The app service definition</span>
<span class=hll>  <span class=nt>mysql</span><span class=p>:</span>
</span><span class=hll>    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysql:5.7</span>
</span></code></pre></div> </li> <li> <p>Next, we'll define the volume mapping. When we ran the container with <code>docker run</code>, the named volume was created automatically. However, that doesn't happen when running with Compose. We need to define the volume in the top-level <code>volumes:</code> section and then specify the mountpoint in the service config. By simply providing only the volume name, the default options are used. There are <a href=https://docs.docker.com/compose/compose-file/compose-file-v3/#volume-configuration-reference>many more options available</a> though.</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span> <span class=s>&quot;3.8&quot;</span>

<span class=nt>services</span><span class=p>:</span>
  <span class=nt>app</span><span class=p>:</span>
    <span class=c1># The app service definition</span>
  <span class=nt>mysql</span><span class=p>:</span>
    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysql:5.7</span>
<span class=hll>    <span class=nt>volumes</span><span class=p>:</span>
</span><span class=hll>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">todo-mysql-data:/var/lib/mysql</span>
</span><span class=hll>
</span><span class=hll><span class=nt>volumes</span><span class=p>:</span>
</span><span class=hll>  <span class=nt>todo-mysql-data</span><span class=p>:</span>
</span></code></pre></div> </li> <li> <p>Finally, we only need to specify the environment variables.</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span> <span class=s>&quot;3.8&quot;</span>

<span class=nt>services</span><span class=p>:</span>
  <span class=nt>app</span><span class=p>:</span>
    <span class=c1># The app service definition</span>
  <span class=nt>mysql</span><span class=p>:</span>
    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysql:5.7</span>
    <span class=nt>volumes</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">todo-mysql-data:/var/lib/mysql</span>
<span class=hll>    <span class=nt>environment</span><span class=p>:</span> 
</span><span class=hll>      <span class=nt>MYSQL_ROOT_PASSWORD</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">secret</span>
</span><span class=hll>      <span class=nt>MYSQL_DATABASE</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">todos</span>
</span>
<span class=nt>volumes</span><span class=p>:</span>
  <span class=nt>todo-mysql-data</span><span class=p>:</span>
</code></pre></div> </li> </ol> <p>At this point, our complete <code>docker-compose.yml</code> should look like this:</p> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span> <span class=s>&quot;3.8&quot;</span>

<span class=nt>services</span><span class=p>:</span>
  <span class=nt>app</span><span class=p>:</span>
    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">node:12-alpine</span>
    <span class=nt>command</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span>
    <span class=nt>ports</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3000:3000</span>
    <span class=nt>working_dir</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/app</span>
    <span class=nt>volumes</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./:/app</span>
    <span class=nt>environment</span><span class=p>:</span>
      <span class=nt>MYSQL_HOST</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
      <span class=nt>MYSQL_USER</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
      <span class=nt>MYSQL_PASSWORD</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">secret</span>
      <span class=nt>MYSQL_DB</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">todos</span>

  <span class=nt>mysql</span><span class=p>:</span>
    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysql:5.7</span>
    <span class=nt>volumes</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">todo-mysql-data:/var/lib/mysql</span>
    <span class=nt>environment</span><span class=p>:</span> 
      <span class=nt>MYSQL_ROOT_PASSWORD</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">secret</span>
      <span class=nt>MYSQL_DATABASE</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">todos</span>

<span class=nt>volumes</span><span class=p>:</span>
  <span class=nt>todo-mysql-data</span><span class=p>:</span>
</code></pre></div> <h2 id=running-our-application-stack>Running our Application Stack<a class=headerlink href=#running-our-application-stack title="Permanent link">&para;</a></h2> <p>Now that we have our <code>docker-compose.yml</code> file, we can start it up!</p> <ol> <li> <p>Make sure no other copies of the app/db are running first (<code>docker ps</code> and <code>docker rm -f &lt;ids&gt;</code>).</p> </li> <li> <p>Start up the application stack using the <code>docker-compose up</code> command. We'll add the <code>-d</code> flag to run everything in the background.</p> <div class=highlight><pre><span></span><code>docker-compose up -d
</code></pre></div> <p>When we run this, we should see output like this:</p> <div class=highlight><pre><span></span><code>Creating network &quot;app_default&quot; with the default driver
Creating volume &quot;app_todo-mysql-data&quot; with default driver
Creating app_app_1   ... done
Creating app_mysql_1 ... done
</code></pre></div> <p>You'll notice that the volume was created as well as a network! By default, Docker Compose automatically creates a network specifically for the application stack (which is why we didn't define one in the compose file).</p> </li> <li> <p>Let's look at the logs using the <code>docker-compose logs -f</code> command. You'll see the logs from each of the services interleaved into a single stream. This is incredibly useful when you want to watch for timing-related issues. The <code>-f</code> flag "follows" the log, so will give you live output as it's generated.</p> <p>If you don't already, you'll see output that looks like this...</p> <div class=highlight><pre><span></span><code>mysql_1  | 2019-10-03T03:07:16.083639Z 0 [Note] mysqld: ready for connections.
mysql_1  | Version: &#39;5.7.27&#39;  socket: &#39;/var/run/mysqld/mysqld.sock&#39;  port: 3306  MySQL Community Server (GPL)
app_1    | Connected to mysql db at host mysql
app_1    | Listening on port 3000
</code></pre></div> <p>The service name is displayed at the beginning of the line (often colored) to help distinguish messages. If you want to view the logs for a specific service, you can add the service name to the end of the logs command (for example, <code>docker-compose logs -f app</code>).</p> <div class="admonition info"> <p class=admonition-title>Pro tip - Waiting for the DB before starting the app</p> <p>When the app is starting up, it actually sits and waits for MySQL to be up and ready before trying to connect to it. Docker doesn't have any built-in support to wait for another container to be fully up, running, and ready before starting another container. For Node-based projects, you can use the <a href=https://github.com/dwmkerr/wait-port>wait-port</a> dependency. Similar projects exist for other languages/frameworks.</p> </div> </li> <li> <p>At this point, you should be able to open your app and see it running. And hey! We're down to a single command!</p> </li> </ol> <h2 id=seeing-our-app-stack-in-docker-dashboard>Seeing our App Stack in Docker Dashboard<a class=headerlink href=#seeing-our-app-stack-in-docker-dashboard title="Permanent link">&para;</a></h2> <p>If we look at the Docker Dashboard, we'll see that there is a group named <strong>app</strong>. This is the "project name" from Docker Compose and used to group the containers together. By default, the project name is simply the name of the directory that the <code>docker-compose.yml</code> was located in.</p> <p><img alt="Docker Dashboard with app project" src=dashboard-app-project-collapsed.png></p> <p>If you twirl down the app, you will see the two containers we defined in the compose file. The names are also a little more descriptive, as they follow the pattern of <code>&lt;project-name&gt;_&lt;service-name&gt;_&lt;replica-number&gt;</code>. So, it's very easy to quickly see what container is our app and which container is the mysql database.</p> <p><img alt="Docker Dashboard with app project expanded" src=dashboard-app-project-expanded.png></p> <h2 id=tearing-it-all-down>Tearing it All Down<a class=headerlink href=#tearing-it-all-down title="Permanent link">&para;</a></h2> <p>When you're ready to tear it all down, simply run <code>docker-compose down</code> or hit the trash can on the Docker Dashboard for the entire app. The containers will stop and the network will be removed.</p> <div class="admonition warning"> <p class=admonition-title>Removing Volumes</p> <p>By default, named volumes in your compose file are NOT removed when running <code>docker-compose down</code>. If you want to remove the volumes, you will need to add the <code>--volumes</code> flag.</p> <p>The Docker Dashboard does <em>not</em> remove volumes when you delete the app stack.</p> </div> <p>Once torn down, you can switch to another project, run <code>docker-compose up</code> and be ready to contribute to that project! It really doesn't get much simpler than that!</p> <h2 id=recap>Recap<a class=headerlink href=#recap title="Permanent link">&para;</a></h2> <p>In this section, we learned about Docker Compose and how it helps us dramatically simplify the defining and sharing of multi-service applications. We created a Compose file by translating the commands we were using into the appropriate compose format.</p> <p>At this point, we're starting to wrap up the tutorial. However, there are a few best practices about image building we want to cover, as there is a big issue with the Dockerfile we've been using. So, let's take a look!</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../multi-container-apps/ title="Multi-Container Apps" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Multi-Container Apps </span> </div> </a> <a href=../image-building-best-practices/ title="Image Building Best Practices" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> Image Building Best Practices </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Docker </div> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://github.com/docker/getting-started target=_blank rel=noopener title=github-alt class="md-footer-social__link fa fa-github-alt"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c33a9706.js></script> <script>app.initialize({version:"1.3.0",url:{base:"../.."}})</script> </body> </html>